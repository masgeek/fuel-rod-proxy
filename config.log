networks:
  internal:
    external: false
  web:
    external: true
    name: web
services:
  adminer:
    container_name: adminer
    depends_on:
      db:
        condition: service_started
    environment:
      ADMINER_DEFAULT_DB_DRIVER: mysql
      ADMINER_DEFAULT_DB_HOST: db
      ADMINER_DEFAULT_DB_NAME: fuelrod
      ADMINER_DESIGN: flat
      ADMINER_PLUGINS: dump-date tables-filter tinymce foreign-system dump-zip dump-alter
    image: adminer
    links:
    - db:mysql
    networks:
      internal: null
      web: null
    ports:
    - 9080:8080/tcp
    restart: on-failure
  certbot:
    container_name: certbot
    entrypoint: /bin/sh -c 'trap exit TERM; while :; do certbot renew; sleep 12h &
      wait $${!}; done;'
    image: certbot/certbot
    networks:
      internal: null
    restart: unless-stopped
    volumes:
    - /home/sammy/services/proxy-tool/data/certbot/conf:/etc/letsencrypt:rw
    - /home/sammy/services/proxy-tool/data/certbot/www:/var/www/certbot:rw
  db:
    container_name: db
    environment:
      MYSQL_DATABASE: fuelrod
      MYSQL_PASSWORD: fuelrod
      MYSQL_ROOT_HOST: '%'
      MYSQL_ROOT_PASSWORD: fuelrod
      MYSQL_USER: fuelrod
      REMOTE_SQL: /home/sammy/services/proxy-tool/mysql-init-files/init.sql
    image: mysql:8.0.21
    networks:
      internal: null
    restart: always
    volumes:
    - /home/sammy/services/proxy-tool/mysql-init-files:/docker-entrypoint-initdb.d:rw
    - /home/sammy/services/proxy-tool/db_data:/var/lib/mysql:rw
    - /home/sammy/services/proxy-tool/db_conf:/etc/mysql/conf.d:rw
  dozzle:
    container_name: dozzle
    environment:
      DOZZLE_TAILSIZE: 200
      LOGSENE_ENABLED: "false"
    image: amir20/dozzle:latest
    mem_limit: 100m
    networks:
      internal: null
      web: null
    ports:
    - 9999:8080/tcp
    restart: unless-stopped
    volumes:
    - /var/run/docker.sock:/var/run/docker.sock:rw
  fuelrod:
    container_name: fuelrod
    depends_on:
      db:
        condition: service_started
    environment:
      DB_PASS: fuelrod
      DB_URL: mysql://fuelrod:fuelrod@db:3306/fuelrod
      DB_USER: fuelrod
      OPT_OUT: '"STOP*456*9*5#"'
      SPRING_PROFILES_ACTIVE: uat
    hostname: fuelrod
    image: tsobu/fuelrod-service-api:latest
    networks:
      internal: null
      web: null
    ports:
    - 9000:9000/tcp
    restart: always
    volumes:
    - /home/sammy/services/proxy-tool/log:/log:rw
  logdna:
    container_name: logdna
    environment:
      LOGDNA_KEY: 2a2127e85b0c300a8a0c964abfa7c09e
    image: logdna/logspout:latest
    mem_limit: 100M
    restart: always
    volumes:
    - /var/run/docker.sock:/var/run/docker.sock:rw
  nginx:
    container_name: nginx
    image: nginx:latest
    links:
    - portal:portal
    - fuelrod:fuelrod
    mem_limit: 120m
    networks:
      internal: null
      web: null
    ports:
    - 80:80/tcp
    - 443:443/tcp
    restart: unless-stopped
    volumes:
    - /home/sammy/services/proxy-tool/nginx:/etc/nginx/conf.d:rw
    - /home/sammy/services/proxy-tool/data/certbot/conf:/etc/letsencrypt:rw
    - /home/sammy/services/proxy-tool/data/certbot/www:/var/www/certbot:rw
  portal:
    container_name: portal
    depends_on:
      fuelrod:
        condition: service_started
    hostname: portal
    image: tsobu/fuelrod-portal:latest
    mem_limit: 300M
    networks:
      internal: null
      web: null
    ports:
    - 5000:5000/tcp
    restart: on-failure
version: '2.2'
volumes:
  portainer_data: {}

