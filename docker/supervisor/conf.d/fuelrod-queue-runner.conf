; Laravel Queue Workers Configuration
; Organized by priority and function

; This configuration manages Laravel queue workers, grouping them by function and priority.
; Each queue handles specific tasks crucial to the application's workflow.

; - Callback Queue: Processes external call-back responses.
; - Opt-out Queue: Manages user opt-out requests from services.
; - SMS Processing Queue: Handles general SMS dispatch.
; - SMS Update Queue: Updates SMS delivery status.
; - Invoice Processing Queue: Integrates with Zoho for invoice-related tasks.

; All programs inherit from [program:defaults]

[group:laravel-queues]
programs=laravel-callback,laravel-optout,laravel-sms-processing,laravel-sms-update,laravel-zoho
priority=100

; Callback Queue (Priority 300)
[program:laravel-callback]
process_name=%(program_name)s_%(process_num)02d
directory=/var/www/html/fuelrod
command=php artisan queue:work --queue=call-back-disabled --sleep=%(ENV_QUEUE_SLEEP)s --tries=%(ENV_QUEUE_MAX_TRIES)s --timeout=%(ENV_QUEUE_TIMEOUT)s 
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
numprocs=1
stdout_logfile=/var/log/supervisor/laravel-callback.log
stderr_logfile=/var/log/supervisor/laravel-callback-error.log
stopwaitsecs=%(ENV_QUEUE_TIMEOUT)s
priority=300
inherit=defaults

; Opt-out Queue (Priority 400)
[program:laravel-optout]
process_name=%(program_name)s_%(process_num)02d
directory=/var/www/html/fuelrod
command=php artisan queue:work --queue=opt-out --sleep=%(ENV_QUEUE_SLEEP)s --tries=%(ENV_QUEUE_MAX_TRIES)s --timeout=%(ENV_QUEUE_TIMEOUT)s 
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
numprocs=2
stdout_logfile=/var/log/supervisor/laravel-optout.log
stderr_logfile=/var/log/supervisor/laravel-optout-error.log
stopwaitsecs=%(ENV_QUEUE_TIMEOUT)s
priority=400
inherit=defaults

; SMS Processing Queue (Priority 250) uses default queue
[program:laravel-sms-processing]
process_name=%(program_name)s_%(process_num)02d
directory=/var/www/html/fuelrod
command=php artisan queue:work --sleep=%(ENV_QUEUE_SLEEP)s --tries=%(ENV_QUEUE_MAX_TRIES)s --timeout=%(ENV_QUEUE_TIMEOUT)s 
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
numprocs=%(ENV_QUEUE_WORKERS)s
stdout_logfile=/var/log/supervisor/laravel-sms-processing.log
stderr_logfile=/var/log/supervisor/laravel-sms-processing-error.log
stopwaitsecs=%(ENV_QUEUE_TIMEOUT)s
priority=250
inherit=defaults

; SMS Update Queue (Priority 225) uses sms-update queue
[program:laravel-sms-update]
process_name=%(program_name)s_%(process_num)02d
directory=/var/www/html/fuelrod
command=php artisan queue:work --queue=sms-update --sleep=%(ENV_QUEUE_SLEEP)s --tries=%(ENV_QUEUE_MAX_TRIES)s --timeout=%(ENV_QUEUE_TIMEOUT)s 
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
numprocs=%(ENV_QUEUE_WORKERS)s
stdout_logfile=/var/log/supervisor/laravel-sms-update.log
stderr_logfile=/var/log/supervisor/laravel-sms-update-error.log
stopwaitsecs=%(ENV_QUEUE_TIMEOUT)s
priority=225
inherit=defaults

; Invoice Processing Queue (Priority 200) uses zoho queues
[program:laravel-zoho]
process_name=%(program_name)s_%(process_num)02d
directory=/var/www/html/fuelrod
command=php artisan queue:work --queue=zoho --sleep=%(ENV_QUEUE_SLEEP)s --tries=%(ENV_QUEUE_MAX_TRIES)s --timeout=%(ENV_QUEUE_TIMEOUT)s 
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
numprocs=2
stdout_logfile=/var/log/supervisor/laravel-zoho-processing.log
stderr_logfile=/var/log/supervisor/laravel-zoho-processing-error.log
stopwaitsecs=%(ENV_QUEUE_TIMEOUT)s
priority=200
inherit=defaults
